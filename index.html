<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.min.css" />
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="http://code.jquery.com/mobile/1.2.1/jquery.mobile-1.2.1.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
  </head>

<div>
	<input type="text" placeholder ='Name' name="firstname" id="firstname"><br>
	<button class='btn btn-primary'id="save-btn">Save</button>	
</div>

<div>
	<input type="number" placeholder='Quantity' name="qty" id="qty"><br>
	<input type="description" placeholder='Item' name="description" id="description"><br>
	<input type="number" placeholder='Price' name="price" id="price"><br>
	<button id="add-item-btn">Save</button>	
</div>

<div id="stream">
</div>

<ul id="userItems">
</ul>

<div id="subtotal">
</div>
total
<div id="total">
</div>

<script>
  var socket = io.connect('http://localhost:3000');
  var subtotal = 0;

  socket.on('joined', function (people) {
    $("#stream").html('');
    for(var i = 0; i < people.length; i++){
      var person = people[i];
      $("#stream").append("<li>" + person.name + " in the room</li>");
    }
  });

  socket.on('addTotal', function (total) {
    $("#total").html(total);
  });

  $('#save-btn').on('click', function(){
    socket.emit('joined', collectData());
  });

  $('#add-item-btn').on('click', function(){
    var qty = $('#qty').val();
    var price = $('#price').val();
    var description = $('#description').val();
    var msg =  qty + " " + description + " each costing " + price;
    $("#userItems").append("<li data-price='" + price + "' data-qty='" + qty + "' data-description='" + description + "'>" + msg + "</li>");

    subtotal = qty * price;
    //$("#subtotal").html(subtotal);
    socket.emit('addTotal', collectData());
  });

  var collectData = function(){
    var firstname = $('#firstname').val();
    var qty = $('#qty').val();
    var price = $('#price').val();
    var description = $('#description').val();
    var items = [];
    $("#userItems li").each(function (index, li){
      var qty = $(li).data('qty');
      var price = $(li).data('price');
      var description = $(li).data('description');
      items.push({
        qty: qty,
        price: price,
        description: description
      });
    });

    return {name: firstname, items: items};
  };
</script>
</html>